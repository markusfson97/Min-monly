<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monly - Din personliga budgetapp</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/react.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/react-dom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            color: #e8eaf6;
            min-height: 100vh;
        }

        #root {
            min-height: 100vh;
        }

        .monly-app {
            max-width: 480px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .view-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .view-header h2 {
            font-size: 24px;
            font-weight: 700;
            color: #e8eaf6;
            flex: 1;
            text-align: center;
        }

        .icon-button {
            background: none;
            border: none;
            color: #667eea;
            cursor: pointer;
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 18px;
            transition: all 0.2s ease;
        }

        .icon-button:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .primary-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
            width: 100%;
            margin-bottom: 12px;
        }

        .primary-button:hover {
            transform: translateY(-4px);
        }

        .secondary-button {
            background: rgba(159, 168, 218, 0.1);
            color: #667eea;
            border: 2px solid rgba(159, 168, 218, 0.2);
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s ease;
            width: 100%;
        }

        .secondary-button:hover {
            background: rgba(159, 168, 218, 0.15);
        }

        .start-view {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 40px);
            gap: 32px;
        }

        .logo-section {
            text-align: center;
        }

        .logo {
            font-size: 64px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
            letter-spacing: -2px;
        }

        .tagline {
            font-size: 16px;
            color: #9fa8da;
            font-weight: 500;
        }

        .create-account-form-view,
        .create-account-income-view,
        .budget-view,
        .category-view,
        .total-result-view {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .income-input {
            background: rgba(10, 14, 39, 0.6);
            border: 2px solid rgba(159, 168, 218, 0.2);
            border-radius: 12px;
            padding: 16px;
            font-size: 16px;
            color: #e8eaf6;
            font-weight: 600;
        }

        .income-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .expense-input {
            background: rgba(10, 14, 39, 0.6);
            border: 2px solid rgba(159, 168, 218, 0.2);
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 14px;
            color: #e8eaf6;
            font-family: inherit;
        }

        .expense-input:focus {
            outline: none;
            border-color: #667eea;
        }

        select {
            background: rgba(10, 14, 39, 0.6);
            border: 2px solid rgba(159, 168, 218, 0.2);
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 14px;
            color: #e8eaf6;
            font-family: inherit;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
        }

        .category-card {
            background: rgba(159, 168, 218, 0.08);
            border: 1px solid rgba(159, 168, 218, 0.2);
            border-radius: 16px;
            padding: 16px;
        }

        .category-card h3 {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .category-card .percentage {
            font-size: 12px;
            color: #667eea;
            margin-bottom: 8px;
        }

        .category-card .budget-amount {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .category-add-button {
            background: rgba(102, 126, 234, 0.2);
            border: 1px solid rgba(102, 126, 234, 0.4);
            border-radius: 8px;
            padding: 8px;
            color: #667eea;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            width: 100%;
            transition: all 0.2s ease;
            margin-top: 12px;
        }

        .category-add-button:hover {
            background: rgba(102, 126, 234, 0.3);
        }

        @media (max-width: 480px) {
            .monly-app {
                padding: 16px;
            }

            .logo {
                font-size: 48px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Mock lucide-react icons
        const Calendar = () => 'üìÖ';
        const User = () => 'üë§';
        const TrendingUp = () => 'üìà';
        const Edit3 = () => '‚úèÔ∏è';
        const Plus = () => '‚ûï';
        const Trash2 = () => 'üóëÔ∏è';
        const ArrowLeft = () => '‚Üê';
        const Check = () => '‚úÖ';
        const X = () => '‚ùå';
        const ArrowRight = () => '‚Üí';

        const formatCurrency = (amount) => {
            return new Intl.NumberFormat('sv-SE', {
                style: 'currency',
                currency: 'SEK',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0,
            }).format(amount);
        };

        const Monly = () => {
            const APP_VERSION = '3.0';

            useEffect(() => {
                const savedVersion = localStorage.getItem('monly_app_version');
                if (savedVersion !== APP_VERSION) {
                    localStorage.clear();
                    localStorage.setItem('monly_app_version', APP_VERSION);
                }
            }, []);

            const [view, setView] = useState('start');
            const [currentMonth, setCurrentMonth] = useState(null);
            const [selectedCategory, setSelectedCategory] = useState(null);
            
            const [newAccountName, setNewAccountName] = useState('');
            const [newAccountYear, setNewAccountYear] = useState(new Date().getFullYear());
            const [newAccountMonth, setNewAccountMonth] = useState(new Date().getMonth() + 1);
            const [newAccountPercentages, setNewAccountPercentages] = useState({ fasta: 50, nojen: 30, sparande: 20 });
            const [newAccountBudgetModel, setNewAccountBudgetModel] = useState('recommended');
            
            const [accounts, setAccounts] = useState([]);
            const [currentAccountId, setCurrentAccountId] = useState(null);
            const [deleteConfirmation, setDeleteConfirmation] = useState({ show: false, accountId: null, accountName: '', monthCount: 0 });

            const currentAccount = accounts.find(acc => acc.id === currentAccountId);
            const months = currentAccount?.months || [];

            useEffect(() => {
                const saved = localStorage.getItem('monly_accounts');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    setAccounts(parsed);
                    if (parsed.length > 0) {
                        setCurrentAccountId(parsed[0].id);
                    }
                }
            }, []);

            useEffect(() => {
                if (accounts.length > 0) {
                    localStorage.setItem('monly_accounts', JSON.stringify(accounts));
                }
            }, [accounts]);

            const updateCurrentAccount = (updates) => {
                setAccounts(accounts.map(acc => 
                    acc.id === currentAccountId ? { ...acc, ...updates } : acc
                ));
            };

            const calculateRemaining = (categoryKey) => {
                if (!currentMonth) return 0;
                const category = currentMonth.categories[categoryKey];
                const spent = category.items.reduce((sum, item) => sum + item.amount, 0);
                return category.budget - spent;
            };

            const addExpenseToCategory = (categoryKey, name, amount) => {
                if (!name || !amount || amount <= 0) return;
                const updated = { ...currentMonth };
                updated.categories[categoryKey].items.push({
                    id: Date.now(),
                    name,
                    amount: parseFloat(amount)
                });
                setCurrentMonth(updated);
                const idx = months.findIndex(m => m.monthKey === updated.monthKey);
                const newMonths = [...months];
                newMonths[idx] = updated;
                updateCurrentAccount({ months: newMonths });
            };

            const deleteExpenseFromCategory = (categoryKey, itemId) => {
                const updated = { ...currentMonth };
                updated.categories[categoryKey].items = updated.categories[categoryKey].items.filter(i => i.id !== itemId);
                setCurrentMonth(updated);
                const idx = months.findIndex(m => m.monthKey === updated.monthKey);
                const newMonths = [...months];
                newMonths[idx] = updated;
                updateCurrentAccount({ months: newMonths });
            };

            const deleteAccount = (accountId) => {
                if (accounts.length <= 1) {
                    alert('Du m√•ste ha minst ett konto');
                    return;
                }
                const updated = accounts.filter(acc => acc.id !== accountId);
                setAccounts(updated);
                if (currentAccountId === accountId) {
                    setCurrentAccountId(updated[0].id);
                    setCurrentMonth(null);
                }
                setDeleteConfirmation({ show: false, accountId: null, accountName: '', monthCount: 0 });
            };

            const showDeleteConfirmation = (account) => {
                setDeleteConfirmation({
                    show: true,
                    accountId: account.id,
                    accountName: account.name,
                    monthCount: account.months.length
                });
            };

            const calculateTotals = () => {
                let totalIncome = 0, totalSaving = 0, totalExpenses = 0;
                months.forEach(month => {
                    totalIncome += month.income;
                    Object.keys(month.categories).forEach(catKey => {
                        const spent = month.categories[catKey].items.reduce((sum, item) => sum + item.amount, 0);
                        if (catKey === 'sparande') {
                            totalSaving += spent;
                        } else {
                            totalExpenses += spent;
                        }
                    });
                });
                return { totalIncome, totalSaving, totalExpenses };
            };

            function StartView() {
                const lastMonth = months.length > 0 ? months[months.length - 1] : null;
                const isFirstTime = months.length === 0;
                
                return (
                    <div className="start-view">
                        <div className="logo-section">
                            <h1 className="logo">Monly</h1>
                            <p className="tagline">Enkel privatekonomi f√∂r alla</p>
                        </div>

                        {isFirstTime ? (
                            <button className="primary-button" onClick={() => setView('createAccountForm')} style={{ fontSize: '16px', padding: '16px' }}>
                                <Calendar /> Skapa din f√∂rsta m√•nad
                            </button>
                        ) : (
                            <>
                                <button className="primary-button" onClick={() => setView('createAccountForm')} style={{ fontSize: '16px', padding: '16px', marginBottom: '12px' }}>
                                    <Calendar /> + Skapa ny m√•nadsbudget
                                </button>
                                <button className="secondary-button" onClick={() => {
                                    setCurrentMonth(lastMonth);
                                    setView('budget');
                                }}>
                                    Se senaste m√•nad
                                </button>
                            </>
                        )}
                    </div>
                );
            }

            function CreateAccountFormView() {
                const monthNames = ['Januari', 'Februari', 'Mars', 'April', 'Maj', 'Juni', 'Juli', 'Augusti', 'September', 'Oktober', 'November', 'December'];
                const years = [new Date().getFullYear() - 1, new Date().getFullYear(), new Date().getFullYear() + 1];
                const totalPercentage = Object.values(newAccountPercentages).reduce((a, b) => a + b, 0);

                const handleBudgetModelChange = (model) => {
                    setNewAccountBudgetModel(model);
                    if (model === 'recommended') {
                        setNewAccountPercentages({ fasta: 50, nojen: 30, sparande: 20 });
                    } else if (model === 'sparfokus') {
                        setNewAccountPercentages({ fasta: 50, nojen: 20, sparande: 30 });
                    }
                };

                const handleStart = () => {
                    if (!newAccountName.trim()) {
                        alert('Ange kontonamn');
                        return;
                    }
                    if (totalPercentage !== 100) {
                        alert('Budgetf√∂rdelningen m√•ste vara 100%');
                        return;
                    }
                    setView('createAccountIncome');
                };

                return (
                    <div className="create-account-form-view">
                        <div className="view-header">
                            <button className="icon-button" onClick={() => setView('start')}>
                                <ArrowLeft />
                            </button>
                            <h2>Skapa din f√∂rsta m√•nad</h2>
                            <div></div>
                        </div>

                        <div style={{ marginBottom: '24px' }}>
                            <label style={{ display: 'block', fontSize: '14px', color: '#9fa8da', marginBottom: '8px', fontWeight: '600' }}>
                                1. Kontonamn
                            </label>
                            <input
                                type="text"
                                value={newAccountName}
                                onChange={(e) => setNewAccountName(e.target.value)}
                                placeholder="T.ex. Privat konto"
                                className="expense-input"
                                style={{ width: '100%' }}
                            />
                            <p style={{ fontSize: '12px', color: '#667eea', marginTop: '6px' }}>
                                {newAccountName.length > 0 ? `${newAccountName.length} tecken` : 'Skriv ditt kontonamn h√§r'}
                            </p>
                        </div>

                        <div style={{ marginBottom: '24px' }}>
                            <label style={{ display: 'block', fontSize: '14px', color: '#9fa8da', marginBottom: '8px', fontWeight: '600' }}>
                                2. V√§lj m√•nad & √•r
                            </label>
                            <div style={{ display: 'flex', gap: '12px' }}>
                                <select value={newAccountMonth} onChange={(e) => setNewAccountMonth(parseInt(e.target.value))} className="expense-input" style={{ flex: 1 }}>
                                    {monthNames.map((m, i) => (
                                        <option key={i} value={i + 1}>{m}</option>
                                    ))}
                                </select>
                                <select value={newAccountYear} onChange={(e) => setNewAccountYear(parseInt(e.target.value))} className="expense-input" style={{ flex: 1 }}>
                                    {years.map(y => (
                                        <option key={y} value={y}>{y}</option>
                                    ))}
                                </select>
                            </div>
                        </div>

                        <div style={{ marginBottom: '24px' }}>
                            <label style={{ display: 'block', fontSize: '14px', color: '#9fa8da', marginBottom: '12px', fontWeight: '600' }}>
                                3. Budgetf√∂rdelning
                            </label>

                            <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                                <button
                                    onClick={() => handleBudgetModelChange('recommended')}
                                    style={{
                                        background: newAccountBudgetModel === 'recommended' ? 'rgba(102, 126, 234, 0.3)' : 'rgba(159, 168, 218, 0.1)',
                                        border: newAccountBudgetModel === 'recommended' ? '2px solid rgba(102, 126, 234, 0.6)' : '2px solid rgba(159, 168, 218, 0.2)',
                                        borderRadius: '12px',
                                        padding: '12px',
                                        color: '#e8eaf6',
                                        cursor: 'pointer',
                                        textAlign: 'left',
                                        transition: 'all 0.2s ease'
                                    }}
                                >
                                    <div style={{ fontWeight: '600', marginBottom: '4px' }}>Rekommenderad (50/30/20)</div>
                                    <div style={{ fontSize: '12px', color: '#9fa8da' }}>Fasta: 50% | N√∂jen: 30% | Sparande: 20%</div>
                                </button>

                                <button
                                    onClick={() => handleBudgetModelChange('sparfokus')}
                                    style={{
                                        background: newAccountBudgetModel === 'sparfokus' ? 'rgba(102, 126, 234, 0.3)' : 'rgba(159, 168, 218, 0.1)',
                                        border: newAccountBudgetModel === 'sparfokus' ? '2px solid rgba(102, 126, 234, 0.6)' : '2px solid rgba(159, 168, 218, 0.2)',
                                        borderRadius: '12px',
                                        padding: '12px',
                                        color: '#e8eaf6',
                                        cursor: 'pointer',
                                        textAlign: 'left',
                                        transition: 'all 0.2s ease'
                                    }}
                                >
                                    <div style={{ fontWeight: '600', marginBottom: '4px' }}>Sparfokus (50/20/30)</div>
                                    <div style={{ fontSize: '12px', color: '#9fa8da' }}>Fasta: 50% | N√∂jen: 20% | Sparande: 30%</div>
                                </button>
                            </div>
                        </div>

                        <button className="primary-button" onClick={handleStart} style={{ marginBottom: '12px' }}>
                            B√∂rja budgetera
                        </button>

                        <button className="secondary-button" onClick={() => setView('start')}>
                            Avbryt
                        </button>
                    </div>
                );
            }

            function CreateAccountIncomeView() {
                const [incomeInput, setIncomeInput] = useState('');
                const monthNames = ['', 'Januari', 'Februari', 'Mars', 'April', 'Maj', 'Juni', 'Juli', 'Augusti', 'September', 'Oktober', 'November', 'December'];
                const displayDate = `${monthNames[newAccountMonth]} ${newAccountYear}`;

                const handleNext = () => {
                    if (!incomeInput || parseFloat(incomeInput) <= 0) {
                        alert('Ange en gyldig inkomst');
                        return;
                    }

                    const newAccount = {
                        id: 'account_' + Date.now(),
                        name: newAccountName,
                        months: [],
                        profile: { name: '', occupation: '', notes: '' },
                        allExpenses: { fasta: [], nojen: [], sparande: [] }
                    };

                    const monthKey = `${newAccountYear}-${String(newAccountMonth).padStart(2, '0')}`;
                    const income = parseFloat(incomeInput);

                    const newMonth = {
                        monthKey,
                        displayDate,
                        income,
                        extraIncome: 0,
                        extraIncomeDistribution: { fasta: 0, nojen: 0, sparande: 0 },
                        budgetModel: newAccountBudgetModel,
                        categories: {
                            fasta: {
                                name: 'Fasta kostnader',
                                percentage: newAccountPercentages.fasta,
                                budget: income * (newAccountPercentages.fasta / 100),
                                items: []
                            },
                            nojen: {
                                name: 'N√∂jen',
                                percentage: newAccountPercentages.nojen,
                                budget: income * (newAccountPercentages.nojen / 100),
                                items: []
                            },
                            sparande: {
                                name: 'Sparande',
                                percentage: newAccountPercentages.sparande,
                                budget: income * (newAccountPercentages.sparande / 100),
                                items: []
                            }
                        }
                    };

                    newAccount.months = [newMonth];
                    const updated = [...accounts, newAccount];
                    setAccounts(updated);
                    setCurrentAccountId(newAccount.id);
                    setCurrentMonth(newMonth);
                    setView('budget');
                };

                return (
                    <div className="create-account-income-view">
                        <div className="view-header">
                            <button className="icon-button" onClick={() => setView('createAccountForm')}>
                                <ArrowLeft />
                            </button>
                            <h2>Inkomst denna m√•nad</h2>
                            <div></div>
                        </div>

                        <div style={{ marginBottom: '32px', textAlign: 'center' }}>
                            <p style={{ fontSize: '14px', color: '#9fa8da', marginBottom: '16px' }}>{displayDate}</p>
                            <p style={{ fontSize: '13px', color: '#667eea', fontWeight: '600' }}>
                                Fasta {newAccountPercentages.fasta}% | N√∂jen {newAccountPercentages.nojen}% | Sparande {newAccountPercentages.sparande}%
                            </p>
                        </div>

                        <div style={{ marginBottom: '24px' }}>
                            <label style={{ display: 'block', fontSize: '14px', color: '#9fa8da', marginBottom: '8px', fontWeight: '600' }}>
                                Din m√•nadsinkomst
                            </label>
                            <input
                                type="number"
                                value={incomeInput}
                                onChange={(e) => setIncomeInput(e.target.value)}
                                placeholder="0"
                                className="income-input"
                            />
                        </div>

                        {incomeInput && parseFloat(incomeInput) > 0 && (
                            <div style={{ background: 'rgba(102, 126, 234, 0.1)', border: '1px solid rgba(102, 126, 234, 0.3)', borderRadius: '12px', padding: '16px', marginBottom: '24px' }}>
                                <h3 style={{ fontSize: '13px', color: '#667eea', marginBottom: '12px', fontWeight: '600' }}>
                                    Din budgetf√∂rdelning
                                </h3>
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px', fontSize: '13px' }}>
                                    <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                                        <span>Fasta kostnader:</span>
                                        <span>{formatCurrency(parseFloat(incomeInput) * (newAccountPercentages.fasta / 100))}</span>
                                    </div>
                                    <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                                        <span>N√∂jen:</span>
                                        <span>{formatCurrency(parseFloat(incomeInput) * (newAccountPercentages.nojen / 100))}</span>
                                    </div>
                                    <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                                        <span>Sparande:</span>
                                        <span>{formatCurrency(parseFloat(incomeInput) * (newAccountPercentages.sparande / 100))}</span>
                                    </div>
                                </div>
                            </div>
                        )}

                        <button
                            className="primary-button"
                            onClick={handleNext}
                            disabled={!incomeInput || parseFloat(incomeInput) <= 0}
                            style={{ marginBottom: '12px', opacity: !incomeInput || parseFloat(incomeInput) <= 0 ? 0.5 : 1 }}
                        >
                            N√§sta
                        </button>

                        <button className="secondary-button" onClick={() => setView('createAccountForm')}>
                            Tillbaka
                        </button>
                    </div>
                );
            }

            function BudgetView() {
                const [incomeInput, setIncomeInput] = useState(currentMonth.income || '');

                const totalBudget = Object.values(currentMonth.categories).reduce((sum, cat) => sum + cat.budget, 0);
                const totalSpent = Object.values(currentMonth.categories).reduce((sum, cat) => sum + cat.items.reduce((s, item) => s + item.amount, 0), 0);

                return (
                    <div className="budget-view">
                        <div className="view-header">
                            <button className="icon-button" onClick={() => setView('start')}>
                                <ArrowLeft />
                            </button>
                            <h2>{currentMonth.displayDate}</h2>
                            <div></div>
                        </div>

                        {currentMonth.income === 0 ? (
                            <div style={{ marginTop: '24px' }}>
                                <label style={{ display: 'block', fontSize: '14px', color: '#9fa8da', marginBottom: '8px', fontWeight: '600' }}>
                                    Inkomst denna m√•nad
                                </label>
                                <input type="number" value={incomeInput} onChange={(e) => setIncomeInput(e.target.value)} placeholder="0" className="income-input" />
                                <button className="primary-button" onClick={() => {
                                    if (incomeInput) {
                                        const updated = { ...currentMonth, income: parseFloat(incomeInput), categories: { ...currentMonth.categories } };
                                        Object.keys(updated.categories).forEach(key => {
                                            updated.categories[key].budget = parseFloat(incomeInput) * (updated.categories[key].percentage / 100);
                                        });
                                        setCurrentMonth(updated);
                                    }
                                }} style={{ marginTop: '12px' }}>
                                    Budgetera
                                </button>
                            </div>
                        ) : (
                            <>
                                <div style={{ background: 'rgba(102, 126, 234, 0.1)', borderRadius: '12px', padding: '16px', marginBottom: '24px' }}>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                        <div>
                                            <p style={{ fontSize: '12px', color: '#9fa8da', marginBottom: '4px' }}>Inkomst</p>
                                            <p style={{ fontSize: '24px', fontWeight: '700', color: '#667eea' }}>{formatCurrency(currentMonth.income)}</p>
                                        </div>
                                    </div>
                                </div>

                                <div className="categories-grid">
                                    {['fasta', 'nojen', 'sparande'].map(key => {
                                        const cat = currentMonth.categories[key];
                                        const spent = cat.items.reduce((sum, item) => sum + item.amount, 0);
                                        const remaining = cat.budget - spent;
                                        
                                        return (
                                            <div key={key} className={`category-card`}>
                                                <h3>{cat.name}</h3>
                                                <div className="percentage">{cat.percentage}%</div>
                                                <div className="budget-amount">{formatCurrency(cat.budget)}</div>
                                                <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '12px', marginBottom: '8px', color: '#9fa8da' }}>
                                                    <span>Anv√§nt:</span>
                                                    <span>{formatCurrency(spent)}</span>
                                                </div>
                                                <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '13px', fontWeight: '600', marginBottom: '12px', color: remaining < 0 ? '#e57373' : '#81c784' }}>
                                                    <span>Kvar:</span>
                                                    <span>{formatCurrency(remaining)}</span>
                                                </div>
                                                <button className="category-add-button" onClick={() => {
                                                    setSelectedCategory({ key, ...cat });
                                                    setView('category');
                                                }}>
                                                    <Plus /> L√§gg till {key === 'fasta' ? 'kostnad' : 'utgift'}
                                                </button>
                                            </div>
                                        );
                                    })}
                                </div>

                                <div style={{ marginTop: '32px', paddingTop: '24px', borderTop: '1px solid rgba(159, 168, 218, 0.2)' }}>
                                    <button className="primary-button" onClick={() => setView('totalResult')} style={{ marginBottom: '12px' }}>
                                        Spara m√•nad
                                    </button>
                                    <button className="secondary-button" onClick={() => setView('start')}>
                                        Tillbaka
                                    </button>
                                </div>
                            </>
                        )}
                    </div>
                );
            }

            function CategoryView() {
                const [newName, setNewName] = useState('');
                const [newAmount, setNewAmount] = useState('');
                const [editingId, setEditingId] = useState(null);
                const [editName, setEditName] = useState('');
                const [editAmount, setEditAmount] = useState('');

                if (!selectedCategory) return null;

                const key = selectedCategory.key;
                const cat = currentMonth.categories[key];

                return (
                    <div className="category-view">
                        <div className="view-header">
                            <button className="icon-button" onClick={() => {
                                setView('budget');
                                setSelectedCategory(null);
                            }}>
                                <ArrowLeft />
                            </button>
                            <h2>{cat.name}</h2>
                            <div></div>
                        </div>

                        <div style={{ display: 'flex', gap: '12px', marginBottom: '24px' }}>
                            <div style={{ flex: 1, background: 'rgba(159, 168, 218, 0.1)', borderRadius: '12px', padding: '16px' }}>
                                <p style={{ fontSize: '12px', color: '#9fa8da', marginBottom: '4px' }}>Budget</p>
                                <p style={{ fontSize: '20px', fontWeight: '700' }}>{formatCurrency(cat.budget)}</p>
                            </div>
                            <div style={{ flex: 1, background: 'rgba(159, 168, 218, 0.1)', borderRadius: '12px', padding: '16px' }}>
                                <p style={{ fontSize: '12px', color: '#9fa8da', marginBottom: '4px' }}>Kvar</p>
                                <p style={{ fontSize: '20px', fontWeight: '700', color: calculateRemaining(key) < 0 ? '#e57373' : '#81c784' }}>{formatCurrency(calculateRemaining(key))}</p>
                            </div>
                        </div>

                        <div style={{ marginBottom: '24px' }}>
                            <h3 style={{ fontSize: '14px', color: '#e8eaf6', marginBottom: '12px', fontWeight: '600' }}>Poster</h3>
                            <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                                {cat.items.map(item => (
                                    <div key={item.id} style={{ background: 'rgba(159, 168, 218, 0.08)', borderRadius: '12px', padding: '12px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                        <span>{item.name}</span>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                            <span style={{ fontWeight: '700', color: '#667eea' }}>{formatCurrency(item.amount)}</span>
                                            <button className="icon-button" onClick={() => deleteExpenseFromCategory(key, item.id)} style={{ color: '#e57373' }}>
                                                <Trash2 />
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div style={{ background: 'rgba(159, 168, 218, 0.05)', borderRadius: '12px', padding: '16px' }}>
                            <h3 style={{ fontSize: '14px', color: '#e8eaf6', marginBottom: '12px', fontWeight: '600' }}>L√§gg till utgift</h3>
                            <input type="text" value={newName} onChange={(e) => setNewName(e.target.value)} placeholder="Namn" className="expense-input" style={{ width: '100%', marginBottom: '8px' }} />
                            <input type="number" value={newAmount} onChange={(e) => setNewAmount(e.target.value)} placeholder="Belopp" className="expense-input" style={{ width: '100%', marginBottom: '8px' }} />
                            <button className="primary-button" onClick={() => {
                                addExpenseToCategory(key, newName, newAmount);
                                setNewName('');
                                setNewAmount('');
                            }}>
                                <Plus /> L√§gg till
                            </button>
                        </div>
                    </div>
                );
            }

            function TotalResultView() {
                const totals = calculateTotals();
                const monthCount = months.length || 1;

                return (
                    <div className="total-result-view">
                        <div className="view-header">
                            <button className="icon-button" onClick={() => setView('budget')}>
                                <ArrowLeft />
                            </button>
                            <h2>Totalt resultat</h2>
                            <div></div>
                        </div>

                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', marginBottom: '24px' }}>
                            <div style={{ background: 'rgba(159, 168, 218, 0.1)', borderRadius: '12px', padding: '16px' }}>
                                <h3 style={{ fontSize: '12px', color: '#9fa8da', marginBottom: '8px', textTransform: 'uppercase', fontWeight: '600' }}>Total inkomst</h3>
                                <p style={{ fontSize: '18px', fontWeight: '700', marginBottom: '6px' }}>{formatCurrency(totals.totalIncome)}</p>
                                <p style={{ fontSize: '12px', color: '#9fa8da' }}>Snitt: {formatCurrency(totals.totalIncome / monthCount)}/m√•n</p>
                            </div>
                            <div style={{ background: 'rgba(159, 168, 218, 0.1)', borderRadius: '12px', padding: '16px' }}>
                                <h3 style={{ fontSize: '12px', color: '#9fa8da', marginBottom: '8px', textTransform: 'uppercase', fontWeight: '600' }}>Totala utgifter</h3>
                                <p style={{ fontSize: '18px', fontWeight: '700', marginBottom: '6px' }}>{formatCurrency(totals.totalExpenses)}</p>
                                <p style={{ fontSize: '12px', color: '#9fa8da' }}>Snitt: {formatCurrency(totals.totalExpenses / monthCount)}/m√•n</p>
                            </div>
                            <div style={{ background: 'rgba(159, 168, 218, 0.1)', borderRadius: '12px', padding: '16px' }}>
                                <h3 style={{ fontSize: '12px', color: '#9fa8da', marginBottom: '8px', textTransform: 'uppercase', fontWeight: '600' }}>Totalt sparande</h3>
                                <p style={{ fontSize: '18px', fontWeight: '700', marginBottom: '6px' }}>{formatCurrency(totals.totalSaving)}</p>
                                <p style={{ fontSize: '12px', color: '#9fa8da' }}>Snitt: {formatCurrency(totals.totalSaving / monthCount)}/m√•n</p>
                            </div>
                        </div>

                        {currentMonth && (
                            <div style={{ background: 'linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.1) 100%)', border: '2px solid rgba(102, 126, 234, 0.4)', borderRadius: '16px', padding: '20px', marginBottom: '24px' }}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '12px' }}>
                                    <h3 style={{ fontSize: '14px', fontWeight: '700', color: '#e8eaf6' }}>
                                        üí∞ Kvar att anv√§nda
                                    </h3>
                                    <button onClick={() => {
                                        setSelectedCategory({ key: 'nojen', ...currentMonth.categories.nojen });
                                        setView('category');
                                    }} style={{ background: 'rgba(102, 126, 234, 0.2)', border: '1px solid rgba(102, 126, 234, 0.4)', borderRadius: '8px', padding: '6px 12px', fontSize: '12px', color: '#667eea', cursor: 'pointer', fontWeight: '600' }}>
                                        <Plus /> L√§gg till
                                    </button>
                                </div>
                                
                                <p style={{ fontSize: '28px', fontWeight: '700', color: '#667eea', marginBottom: '8px' }}>
                                    {formatCurrency(
                                        currentMonth.categories.nojen.budget - 
                                        currentMonth.categories.nojen.items.reduce((sum, item) => sum + item.amount, 0)
                                    )}
                                </p>
                                <p style={{ fontSize: '12px', color: '#9fa8da' }}>
                                    f√∂r n√∂je och underh√•llning
                                </p>
                            </div>
                        )}

                        <button className="primary-button" onClick={() => setView('budget')} style={{ marginBottom: '12px' }}>
                            Tillbaka till budget
                        </button>
                    </div>
                );
            }

            return (
                <div className="monly-app">
                    {view === 'start' && <StartView />}
                    {view === 'createAccountForm' && <CreateAccountFormView />}
                    {view === 'createAccountIncome' && <CreateAccountIncomeView />}
                    {view === 'budget' && currentMonth && <BudgetView />}
                    {view === 'category' && <CategoryView />}
                    {view === 'totalResult' && <TotalResultView />}
                </div>
            );
        };

        ReactDOM.render(<Monly />, document.getElementById('root'));
    </script>
</body>
</html>
